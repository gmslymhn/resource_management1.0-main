"use strict";(self["webpackChunkresource"]=self["webpackChunkresource"]||[]).push([[221],{7105:function(e,s,t){t.r(s),t.d(s,{default:function(){return h}});var o=function(){var e=this,s=e._self._c;return s("div",{staticClass:"messageReported"},[e._m(0),s("div",{staticClass:"messageHeader"},[s("el-badge",{staticClass:"messageHeaderReported",attrs:{value:e.reportedMessage,max:99}},[s("el-button",{attrs:{type:"success"}},[e._v("损坏上报")])],1),s("el-badge",{staticClass:"messageHeaderAssets",attrs:{value:e.assetsMessage,max:99}},[s("el-button",{attrs:{type:"info"},on:{click:e.gotoMessageAssets}},[e._v("资金审批")])],1)],1),s("div",{staticClass:"messageReportedInner"},[s("el-table",{ref:"filterTable",staticClass:"reportedTable",staticStyle:{width:"100%"},attrs:{data:e.tableData}},[s("el-table-column",{attrs:{align:"center",prop:"sequenceId",label:"上报信息id"}}),s("el-table-column",{attrs:{align:"center",prop:"reportNameId",label:"上报人id"}}),s("el-table-column",{attrs:{align:"center",prop:"reportName",label:"上报人"}}),s("el-table-column",{attrs:{align:"center",prop:"goodsId",label:"物品id"}}),s("el-table-column",{attrs:{align:"center",prop:"goodsName",label:"物品名称",formatter:e.formatter}}),s("el-table-column",{attrs:{align:"center",prop:"goodsState",label:"状态",filters:[{text:"未处理",value:"未处理"}],"filter-placement":"bottom-end"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:"info","disable-transitions":""}},[e._v(e._s(t.row.goodsState))])]}}])}),s("el-table-column",{attrs:{align:"center",prop:"damageDescription",label:"损坏描述"}}),s("el-table-column",{attrs:{align:"center",prop:"reportTime",label:"上报时间",sortable:"",width:"160","column-key":"reportTime"}}),s("el-table-column",{attrs:{label:"处理"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(s){return e.disposeButton(t.$index,t.row)}}},[e._v("处理")])]}}])})],1),s("el-dialog",{staticClass:"itemsDialog",attrs:{title:"损坏物品处理",visible:e.dialogFormVisibleEdit,"append-to-body":!0},on:{"update:visible":function(s){e.dialogFormVisibleEdit=s}}},[s("el-form",{ref:"dispose",staticClass:"demo-ruleForm",attrs:{model:e.dispose,rules:e.rules}},[s("el-form-item",{attrs:{label:"上报人",prop:"reportName"}},[s("el-input",{attrs:{disabled:!0},model:{value:e.dispose.reportName,callback:function(s){e.$set(e.dispose,"reportName",s)},expression:"dispose.reportName"}})],1),s("el-form-item",{attrs:{label:"物品id",prop:"goodsId"}},[s("el-input",{attrs:{disabled:!0},model:{value:e.dispose.goodsId,callback:function(s){e.$set(e.dispose,"goodsId",s)},expression:"dispose.goodsId"}})],1),s("el-form-item",{attrs:{label:"物品名字",prop:"goodsName"}},[s("el-input",{attrs:{disabled:!0},model:{value:e.dispose.goodsName,callback:function(s){e.$set(e.dispose,"goodsName",s)},expression:"dispose.goodsName"}})],1),s("el-form-item",{attrs:{label:"上报人描述",prop:"damageDescription"}},[s("el-input",{attrs:{type:"textarea",disabled:!0},model:{value:e.dispose.damageDescription,callback:function(s){e.$set(e.dispose,"damageDescription",s)},expression:"dispose.damageDescription"}})],1),s("el-form-item",{attrs:{label:"是否删除已损坏物品",prop:"goodsState"}},[s("el-radio-group",{model:{value:e.dispose.goodsState,callback:function(s){e.$set(e.dispose,"goodsState",s)},expression:"dispose.goodsState"}},[s("el-radio",{attrs:{label:"是"}}),s("el-radio",{attrs:{label:"否"}})],1)],1),s("el-form-item",{attrs:{label:"是否申请资金购买新物品",prop:"gotoApply"}},[s("el-radio-group",{model:{value:e.dispose.gotoApply,callback:function(s){e.$set(e.dispose,"gotoApply",s)},expression:"dispose.gotoApply"}},[s("el-radio",{attrs:{label:"是"}}),s("el-radio",{attrs:{label:"否"}})],1)],1),s("el-form-item",{attrs:{label:"处理人描述",prop:"disposeDescription"}},[s("el-input",{attrs:{type:"textarea"},model:{value:e.dispose.disposeDescription,callback:function(s){e.$set(e.dispose,"disposeDescription",s)},expression:"dispose.disposeDescription"}})],1),s("el-button",{attrs:{type:"primary"},on:{click:function(s){return e.submitForm()}}},[e._v("提 交")])],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(s){e.dialogFormVisibleEdit=!1}}},[e._v("关 闭")])],1)],1)],1),s("div",{staticClass:"pagination"},[s("Pagination",{attrs:{total:e.total,totalPages:e.totalPages},on:{currentChange:e.currentChange}})],1)])},a=[function(){var e=this,s=e._self._c;return s("div",{staticClass:"itemsText"},[s("p",{staticClass:"itemsTextP"},[e._v("管理员审批")])])}],i=(t(7658),t(7915)),r=t(454),d=t(4092),l=t(4458),p=t(9440),n=t(5433),g=t(7484),m=t.n(g),c={name:"Message-MessageReported",components:{Pagination:l.Z},data(){return{tableData:[],dispose:{reportName:"",goodsId:"",goodsName:"",damageDescription:"",gotoApply:"",goodsState:"",sequenceId:"",disposeNameId:"",disposeName:"",disposeDescription:"",disposeResult:""},rules:{goodsState:[{required:!0,message:"请选择处理状态",trigger:"change"}],gotoApply:[{required:!0,message:"请选择是否跳转到申请资金",trigger:"change"}],disposeDescription:[{required:!0,message:"请填入处理描述",trigger:"blur"}]},total:100,totalPages:10,pageSize:7,pageNum:1,dialogFormVisibleEdit:!1,role:"",reportedMessage:"",assetsMessage:""}},methods:{async getUnprocessedReport(e){let s=await(0,i.n0)({pageNum:e});console.log("未处理损坏物品数据-----",s),s.data&&(this.tableData=[...s.data.data.list],this.total=s.data.data.total,this.totalPages=s.data.data.pages,this.tableData.forEach((e=>{e.reportTime=m()(e.reportTime).format("YYYY-MM-DD HH:mm:ss")})))},async postUpdateProcessedReport(e,s,t,o){let a=await(0,i.PN)({sequenceId:e,disposeNameId:s,disposeName:t,disposeDescription:o});console.log("审批损坏结果-----",a),200===a.state&&(this.$message({type:"success",message:"审批成功咯!"}),this.getUnprocessedReport(1))},async getItemsRemove(e){let s=await(0,r.qQ)({goodsId:e});console.log("产品删除数据-----",s),200===s.status&&this.$message({type:"success",message:"删除成功咯!"})},submitForm(){this.$refs.dispose.validate((e=>{if(!e)return console.log("error submit!!"),!1;console.log("处理提交按钮-----",this.dispose),this.dispose.disposeNameId=Number(this.dispose.disposeNameId),this.postUpdateProcessedReport(this.dispose.sequenceId,this.dispose.disposeNameId,this.dispose.disposeName,this.dispose.disposeDescription),this.dialogFormVisibleEdit=!1,"是"===this.dispose.goodsState&&(console.log("调用物品损坏上报删除接口-----"),this.getItemsRemove(this.dispose.goodsId)),"是"===this.dispose.gotoApply&&("user"===this.role?this.$router.push({name:"user_shenqing"}):"admin"===this.role&&this.$router.push({name:"admin_shenqing"})),setTimeout((()=>{this.getUnprocessedReport(1)}),500)}))},disposeButton(e,s){console.log("处理操作-----",e,s),this.dialogFormVisibleEdit=!0,this.dialogFormVisibleTitle="物品损坏处理",this.dispose.reportName=s.reportName,this.dispose.goodsId=s.goodsId,this.dispose.goodsName=s.goodsName,this.dispose.damageDescription=s.damageDescription,this.dispose.sequenceId=s.sequenceId,this.dispose.disposeNameId=this.$store.state.login.id,this.dispose.disposeName=this.$store.state.login.name,this.dispose.disposeDescription=""},currentChange(e){console.log("更新页码-----",e),this.pageNum=e,this.getUnprocessedReport(e)},formatter(e,s){return e.goodsName},gotoMessageAssets:(0,d.Z)((function(){this.$router.push({name:"admin_message_assets"}).catch((e=>e))}),1500)},created(){this.getUnprocessedReport(1)},mounted(){(0,p.Z)().then((e=>{console.log("resReported",e),this.reportedMessage=e.data.data})),(0,n.Z)().then((e=>{console.log("resAssets",e),this.assetsMessage=e.data.data})),this.role=this.$store.state.login.role}},u=c,b=t(1001),f=(0,b.Z)(u,o,a,!1,null,"536070db",null),h=f.exports},454:function(e,s,t){t.d(s,{S_:function(){return n},aU:function(){return d},lt:function(){return l},qQ:function(){return m},xg:function(){return p},zw:function(){return g}});var o=t(4974),a=t(129),i=t.n(a);const r="/admin/admgoods",d=({pageNum:e,pageSize:s})=>o.Z.post(r+"/getAllGoods",i().stringify({pageNum:e,pageSize:s}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}},{responseType:"arraybuffer"}),l=({formData:e})=>o.Z.post(r+"/addGoods",{uploadImage:e.get("uploadImage"),goodsName:e.get("goodsName"),goodsQuantity:e.get("goodsQuantity"),goodsState:e.get("goodsState")},{headers:{"Content-type":"multipart/form-data"}}),p=({formData:e})=>o.Z.post(r+"/updateGoods",{uploadImage:e.get("uploadImage"),goodsId:e.get("goodsId"),goodsName:e.get("goodsName"),goodsState:e.get("goodsState")},{headers:{"Content-type":"multipart/form-data"}}),n=({pageNum:e,pageSize:s,goodsName:t})=>o.Z.post(r+"/selectGoodsByGoodsName",i().stringify({pageNum:e,pageSize:s,goodsName:t}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}},{responseType:"arraybuffer"}),g=({goodsId:e})=>o.Z.post(r+"/selectGoodsById",i().stringify({goodsId:e}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}},{responseType:"arraybuffer"}),m=({goodsId:e})=>o.Z.get(r+"/deleteGoods",{params:{goodsId:e}})}}]);
//# sourceMappingURL=221.14f15dca.js.map